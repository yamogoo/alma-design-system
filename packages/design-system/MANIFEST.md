# AlmaDesignSystem â€” MANIFEST

**AlmaDesignSystem** is an experimental Vue 3 design-system playground that unifies **components**, **tokens**, **state helpers**, **assets**, and **tooling** inside a single monorepo.

This document snapshots the current architecture: high-level layout, module responsibilities, and integration notes.

## ðŸ—‚ Monorepo Overview

```bash
apps/
  sparkpad/
    client/        # consumer frontend
    server/        # API playground
    log-server/    # logging sink for experiments

packages/
  design-system/   # @alma/design-system â€” Vue kit, tokens, SCSS core, Storybook infra
  tokens-worker/   # @alma/tokens-worker â€” token compiler, converters, build helpers

shared/
  images/          # brand visuals reused by docs and Storybook
```

> Global styles entry point for consumers:
>
> ```scss
> @use "@alma/design-system/app.runtime.scss" as *;
> ```

## ðŸ“‚ Package Layout (`packages/design-system/src`)

```bash
__tests__/        â€” Vitest fixtures, DOM helpers, and mocks
_index.scss       â€” SCSS bundle entry consumed by Storybook
adapters/         â€” environment-specific wrappers around base components
app.runtime.scss  â€” global runtime stylesheet (tokens â†’ CSS vars)
assets/           â€” fonts, icons, animations, and SCSS core
components/       â€” Vue components (atomic design)
composables/      â€” global/local composition utilities
constants/        â€” app + UI constant registries
index.ts          â€” public surface for consumers
stores/           â€” Pinia stores (connection state, etc.)
stories/          â€” Storybook stories, decorators, utilities
tokens/           â€” code-first token source & compiled outputs
typings/          â€” TypeScript contracts exported by the kit
utils/            â€” shared helpers (events, units, sanitize, GSAP guards)
```

`public/`, `dist/`, `tests-report/`, and `stats.html` live at the package root to support build artifacts, Storybook static output, and bundle-inspection reports.

## ðŸ“¦ Modules Overview

### ðŸ”¹ Adapters

Thin wrappers that map raw components into host app contexts (routing, i18n, analytics). Structure mirrors atomic design:

- `abstracts/` â€” shared contracts and adapter base utilities  
- `atoms/`, `molecules/`, `organisms/`, `templates/` â€” wrapper layers; components stay logic-heavy, adapters stay declarative

### ðŸ”¹ Assets

- **animations/** â€” Lottie/JSON animation files (e.g., loader, theme switcher)
- **fonts/** â€” Manrope family (Cyrillic + Latin, 200â€“800) for offline-first usage
- **icons/** â€” Alma icon entry point and SVG registry
- **images/** â€” static imagery for Storybook + docs
- **scss/** â€” SCSS core split into:
  - `abstracts/` â€” tokens, base color maps, breakpoints
  - `core/` â€” mixins/functions (px2rem, themify, map-get)
  - `extends/` â€” animations, containers, component skinning
  - `mixins/` â€” reusable mixins for projects and stories
  - `app.*.scss` â€” global entry files (runtime, fonts, config, etc.)

### ðŸ”¹ Components

Vue 3 + TypeScript components following atomic design:

- Implementation: `.vue` single-file components with colocated logic in `.ts`
- Contracts: props and events exported from dedicated `.ts` files
- Tests: Vitest + Vue Test Utils (`.spec.ts`)
- Stories: `.stories.ts[x]` for Storybook coverage
- Structure: `atoms/`, `molecules/`, `organisms/`, `templates/`, all re-exported via `components/index.ts`

### ðŸ”¹ Composables

Reusable composition functions grouped by scope:

- `global/` â€” theme management, metadata, connection state
- `local/` â€” interaction helpers such as hover, clickOutside, drag-and-drop, timers, storage, router access

### ðŸ”¹ Constants

Centralized config for UI defaults, theming, and feature flags. Consumers import selectively (`constants/app`, `constants/ui`, etc.).

### ðŸ”¹ Stores

Pinia-based state helpers (`useConnectionStore`, â€¦) intended for cross-component experiments. Exposed via `Stores` namespace from `index.ts`.

### ðŸ”¹ Stories

Storybook source:

- `components/` â€” canonical component stories
- `decorators/` â€” global Storybook wrappers
- `pages/` â€” narrative documentation & playgrounds
- `utils/` â€” helpers for story organization (controls, knobs, theme toggles)

### ðŸ”¹ Tokens

Single source of truth for theming and design decisions. Lives inside `packages/design-system/src/tokens`:

```bash
src/            # editable JSON contracts
  _colors.json
  baseColors.json
  breakpoints.json
  colors.json
  motion/       # motion tokens (duration, easing, reserved hybrid runtime controls)
  components/
  config.json
  themes/
  tokens/
  typography/
output/         # generated by tokens-worker (JSON bundles)
structure.md    # documentation of token architecture & contracts
index.ts        # default export bundling compiled outputs
```

Tokens remain code-first. The worker pipeline resolves references, generates relational color matrices, and emits consumable JSON/SCSS artifacts.

### ðŸ”¹ Typings

TypeScript declaration helpers for UI contracts, API surfaces, router models, themes, and ambient declarations (`env.d.ts`, `vite-env.d.ts`).

### ðŸ”¹ Utils

Small reusable helpers (`px2rem`, `sanitize`, `getPathSegment`, `gsapSafe`, event helpers) with unit tests colocated when applicable.

### ðŸ”¹ Testing Support

`__tests__/` supplies DOM mocks and shared Vitest utilities. `vitest.setup.ts` configures test environment (jsdom, global stubs). Tests live next to the implementation they verify.

## ðŸ§° Tokens Worker (`packages/tokens-worker`)

The worker is a standalone package responsible for compiling token sources into runtime assets. Key folders:

- `lib/index.ts` â€” orchestrates builds and exports CLI hooks
- `lib/parsers/` â€” parse relational contracts, resolve references
- `lib/plugins/` â€” output generators (JSON, CSS vars, SCSS maps)

It consumes `design-system/src/tokens/src` as input and writes to `design-system/src/tokens/output`.

## âœ… Rules & Conventions

- `tokens/output/` is generated; never edited manually and excluded from source-of-truth commits
- Adapters must stay thin; business logic belongs inside components/composables
- Every shipped component includes `.vue + .ts + .spec.ts`; stories are strongly encouraged
- Fonts remain vendored for offline-first demos; swapping to CDN is optional
- Temporary experiments live under `**/*.temp/` and are ignored via `.gitignore`

## ðŸ§ª Testing & Tooling

- Vitest + Vue Test Utils, configured for jsdom
- Pinia for lightweight state experiments
- Storybook for visual regression + design reviews
- Bundle stats via `stats.html`, execution reports under `tests-report/`

## ðŸ“– Summary

AlmaDesignSystem centralizes tokens, components, adapters, and tooling in a single package, keeping `tokens-worker` as the build engine. Consumers import runtime styles via `app.runtime.scss`, grab namespaces from `index.ts`, and rely on the generated token bundles for theme-aware UX experiments.
